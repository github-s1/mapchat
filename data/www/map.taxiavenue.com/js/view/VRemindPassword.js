/*  * Напоминание пароля. * Вводится login (e-mail или телефон), который отправляется на сервер. * Сервер отправляет животное для потверждения пользователю, а сюда возвращает  * список живонтых для выбора. * Этот список возвращается вызывающему классу. */define([     'underscore',    'jquery',    'backbone',     'dialog',     'config',    'view/VLoader',     'templates'], function(_, $, Backbone, Dialog, Config, VLoader, templates){    "use strict";        return Backbone.View.extend({                tagName     : 'form',        id          : 'remindPassword',        template    : _.template(templates.remindPassword),                events: {            "click button.back"     :       "back",            "click button.send"     :       "send"        },                initialize: function(options){             this.parent = options.parent;                        this.createDialog();            this.render();            this.setUI();        },                back: function(e) {            e.preventDefault();            this.dialog.close();        },                send: function(e) {            e.preventDefault();            var login = this.getLogin();            if(!login){                return;            }                        var self = this,                loader = new VLoader({                    data: {text: "Обмен данными ... "}                 });            $.when($.ajax({                type: 'POST',                url: Config.baseUrlJSON + "users_json/forgotPassword",                data: {                    login: login                }            })).then(function(response){                response = eval('(' + response + ')').response;                if(response.error){                    self.$("span.error").removeClass("hide").text(response.error.error_msg);                }                else {                    self.parent.remindPasswordAnswer(response);                    self.dialog.close();                }                loader.remove();            });        },                getLogin: function() {            var $login = this.$("[name='login']"),                 login = $.trim($login.val());            $login.val(login);            if(login === ""){                this.$("span.error").removeClass("hide").text("Не заполнено поле 'Логин'");                return false;            }            else {                this.$("span.error").addClass("hide").text("");                return login;            }        },                render: function() {            var view = this.template(this.formData);            this.$el.html(view);            return this;        },                createDialog: function() {            var options = {                modal   : true,                title   : "Напоминание пароля",                width   : 330,//                height  : 230,                height  : "auto",                position: "center top",                resizable: false,                buttons : null            };            this.dialog = new Dialog({widget: this, options: options});        },                setUI: function() {            this.$el.closest("div.dialog.ui-dialog-content.ui-widget-content").css({"padding": "5px"});            var $mainEl = this.$el.closest('div.ui-dialog.ui-widget.ui-widget-content.ui-corner-all.ui-front.ui-draggable');                        var $titleEl = $mainEl.find('div.ui-dialog-titlebar.ui-widget-header.ui-corner-all.ui-helper-clearfix');            $titleEl.css('background', '#00CCFF').css('text-align', 'center');            $titleEl.find('.ui-dialog-titlebar-close').css('display', 'none');        }    });});